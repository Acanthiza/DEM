---
title: DEM comparison
author:
- Nigel Willoughby
- Department for Environment and Water
date: "`r format(Sys.time(), '%A, %d %B, %Y. %H:%M')`"
link-citations: yes
bibliography: packages.bib
description: "This work aims to compare digital terrain models as potential inputs to ecosystem modelling."
---

```{r setup, echo = FALSE, warning = FALSE, error = FALSE, message = FALSE}

  repo_link <- gsub("\\.git$", "", usethis::git_remotes()$origin)

  #------Bibliography-------
  
  url <- "https://raw.githubusercontent.com/citation-style-language/styles/master/emu-austral-ornithology.csl"
  download.file(url, "../common/bib_style.csl")
  
  unlink("packages.bib")
  
  
  #--------knitr options--------
  
  knitr::opts_knit$set(eval.after = "fig.cap")
  
  
  #-------chunk options-------

  knitr::opts_chunk$set(echo = FALSE
                        , warning = FALSE
                        , error = FALSE
                        , message = FALSE
                        , tidy = TRUE
                        , tidy.opts = list(comment = FALSE)
                        #, dpi = 300
                        #, fig.width = 7
                        )

  
  #--------options-------

  options(knitr.kable.NA = ""
          , knitr.duplicate.label = "allow"
          )


  #------citations--------

  # knitcitations::cleanbib()
  # options("citation_format" = "pandoc")
  
  
  #-------Rmd--------
  
  tmap::tmap_mode("plot")
  
  tmap::tmap_options(basemaps = c("OpenStreetMap.Mapnik"
                                  , "Esri.WorldImagery"
                                  )
                     , limits = c(facets.view = 16)
                     )

```

```{r stuff}

  if(!exists("categ")) source("sampleDEM.R")

```

# Aim

To compare digital terrain models as potential inputs to ecosystem modelling.

# Intro

To model ecosystems, the terrain model should be able to distinguish changes in elevation in the order of a few metres above the surrounding area. For example in mallee, dunes a couple of metres high and 10s of metres wide often have different vegetation to the swales between the dunes. Swales can be 100s to 1000s of metres wide.


<!--chapter:end:index.Rmd-->

# Methods

The following `r length(unique(samples$short))` DEMs were available over the `r settings$area` sample area:

* `r paste0(unique(samples$short), collapse = "\n* ")`

For each DEM, the following workflow was applied:

* mask to the minimum available overlap between all DEMs
* reproject into GDA 2020
* aggregate or disaggregate to roughly 10 m from original resolution
* reprojected into the same `r terra::res(samples$ras[[1]])[1]` m raster

Each of the reprojected DEMs were then processed by the `Qfit` function in the `MultiscaleDTM` package `r envReport::cite_package("MultiscaleDTM")` using two values for the `v` argument (window size): `r windows$window %>% envFunc::vec_to_sentence()` cells. The `Qfit` function generates several continuous and one categorical variable for a digital terrain model:

* `r paste0(as.character(formals(MultiscaleDTM::Qfit)$metrics)[-1], collapse = "\n* ")``

A [shiny app](https://ailich.shinyapps.io/Terrain_Attributes_Explorer_App/) is available to investigate the meaning of each of these variables.

To visualise and quantify differences between sample DEMs, the area of overlap between each sample DEM had `r settings$n_sample`

<!--chapter:end:0020_methods.Rmd-->


```{r area_rmd}

  area_rmd <- NULL

  # this loops through area_rmd.Rmd, generating the results for each report card

  for (i in unique(luraster$area)) {
    
    areaID <- i
    
    area_rmd <- c(area_rmd, knit_expand(fs::path(here::here()
                                           , "child"
                                           , "area.Rmd"
                                           )
                                  )
               )
    
  }

```

`r paste(knit(text = area_rmd), collapse = '\n')`

<!--chapter:end:0030_results.Rmd-->

